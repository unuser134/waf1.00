# 🌐 Web 管理界面完全指南

## 📖 概述

WAF 1.0 的 Web 管理界面（`dashboard.html`）提供**可视化部署和管理**功能。

**访问地址**: http://localhost:8082

---

## 🎨 界面结构

```
┌─────────────────────────────────────────────────────┐
│          🛡️ DL混合WAF 1.0 - 管理界面              │
├─────────────────────────────────────────────────────┤
│ [📊 仪表板]  [📋 日志]  [🔒 规则]  [⚪ 白名单]  [🚀 部署] │
├─────────────────────────────────────────────────────┤
│                                                     │
│  (主要内容区)                                      │
│                                                     │
│  [实时刷新] [导出] [筛选] [搜索]                   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 📊 仪表板（Dashboard）

**用途**: 查看系统整体状态和攻击统计

### 显示内容

```
┌─────────────────────────────────────────┐
│  📊 实时状态面板                        │
├─────────────────────────────────────────┤
│                                         │
│  规则加载状态:                          │
│  ✅ 14 条规则已加载                    │
│     ├─ SQL 注入: 4 条                  │
│     ├─ XSS: 4 条                       │
│     ├─ 目录遍历: 3 条                  │
│     ├─ 文件包含: 2 条                  │
│     └─ 恶意文件: 1 条                  │
│                                         │
├─────────────────────────────────────────┤
│  攻击统计（24h/7d/30d）：               │
│                                         │
│  过去 24 小时: ███ 23 次              │
│  过去 7 天:   ███████ 145 次          │
│  过去 30 天:  ██████████ 589 次       │
│                                         │
├─────────────────────────────────────────┤
│  攻击类型分布（饼图）：                 │
│                                         │
│  🔴 SQL 注入 ████ 52%                 │
│  🟠 XSS      ███ 35%                  │
│  🟡 目录遍历 █ 9%                     │
│  🟢 其他     ░ 4%                     │
│                                         │
└─────────────────────────────────────────┘
```

### 交互操作

- **刷新**: 实时更新数据
- **时间范围选择**: 选择 24h/7d/30d
- **饼图交互**: 点击图例过滤

---

## 📋 日志（Logs）

**用途**: 查看所有被拦截的请求详情

### 日志列表

```
┌────────────────────────────────────────────────────────────┐
│  时间          │ IP          │ 攻击类型  │ 严重程度 │ URL │
├────────────────────────────────────────────────────────────┤
│ 2026-01-29    │ 127.0.0.1   │ SQL注入  │ 严重   │ /?id=1... │
│ 14:30:15      │             │         │       │         │
├────────────────────────────────────────────────────────────┤
│ 2026-01-29    │ 192.168.1.100 │ XSS    │ 高     │ /search... │
│ 14:31:22      │             │         │       │         │
├────────────────────────────────────────────────────────────┤
│ 2026-01-29    │ 10.0.0.5    │ 目录遍历│ 中     │ /api/file... │
│ 14:32:45      │             │         │       │         │
└────────────────────────────────────────────────────────────┘
```

### 过滤和搜索

```
┌─────────────────────────────────────────┐
│  过滤条件：                              │
│  ├─ 时间范围: [开始日期] - [结束日期]   │
│  ├─ 攻击类型: [所有▼]                   │
│  │   - 所有                             │
│  │   - SQL 注入                         │
│  │   - XSS                              │
│  │   - 目录遍历                         │
│  │   - 文件包含                         │
│  │   - 恶意文件                         │
│  ├─ IP 地址: [搜索框]                   │
│  └─ [应用筛选] [重置]                   │
└─────────────────────────────────────────┘
```

### 导出功能

```
点击 [导出 CSV] 按钮：
  ↓
下载 attack_logs_YYYYMMDD.csv
  ↓
可在 Excel 中打开进行分析
```

---

## 🔒 规则（Rules）

**用途**: 查看和管理检测规则

### 规则列表

```
┌──────────────────────────────────────────────────────┐
│  规则名称          │ 类别    │ 严重程度 │ 启用 │ 操作 │
├──────────────────────────────────────────────────────┤
│ SQL_OR_1_1        │ SQL注入 │ 严重   │ ✅  │ [详情] [禁用] │
├──────────────────────────────────────────────────────┤
│ SQL_UNION_SELECT  │ SQL注入 │ 严重   │ ✅  │ [详情] [禁用] │
├──────────────────────────────────────────────────────┤
│ XSS_SCRIPT_TAG    │ XSS    │ 严重   │ ✅  │ [详情] [禁用] │
├──────────────────────────────────────────────────────┤
│ DIR_TRAVERSAL_UNIX│ 遍历   │ 高    │ ✅  │ [详情] [禁用] │
├──────────────────────────────────────────────────────┤
│ MALICIOUS_FILE    │ 恶意文件│ 中    │ ❌  │ [详情] [启用] │
└──────────────────────────────────────────────────────┘
```

### 规则详情

```
点击 [详情] 查看规则匹配模式：

┌──────────────────────────────────────────┐
│  SQL_OR_1_1 - SQL 注入规则              │
├──────────────────────────────────────────┤
│  类别: SQL 注入                          │
│  严重程度: 严重 (Critical)               │
│  状态: 启用 ✅                           │
│  匹配模式:                               │
│    1. (?i)(\bor\b.*=.*)                │
│    2. (?i)(\bor\b\s+1\s*=\s*1)         │
│                                         │
│  说明: 检测基础 OR 型 SQL 注入           │
└──────────────────────────────────────────┘
```

### 规则管理

```
【启用/禁用规则】
  - 点击规则行的 [启用] 或 [禁用] 按钮
  - 或在列表中勾选规则，批量操作
  - 立即生效，无需重启

【重新加载规则】
  - 如修改了 rules/*.yaml 文件
  - 点击 [重新加载规则] 按钮
  - 系统会重新加载所有规则文件
```

---

## ⚪ 白名单（Whitelist）

**用途**: 添加信任的 IP 和 URL，跳过检测

### 白名单类型

#### 1. IP 白名单

```
┌─────────────────────────────────────────┐
│  IP 白名单                              │
├─────────────────────────────────────────┤
│                                         │
│  127.0.0.1        ✅ 本地              │
│  192.168.1.100    ✅ 办公网            │
│  10.0.0.0/24      ✅ 子网              │
│                                         │
│  [新增 IP]  [删除选中]  [导入]          │
│                                         │
└─────────────────────────────────────────┘

新增方式:
  IP 地址: [192.168.1.100]
  说明: [办公网络]
  [添加]
```

#### 2. URL 白名单

```
┌─────────────────────────────────────────┐
│  URL 白名单                             │
├─────────────────────────────────────────┤
│                                         │
│  /api/health      ✅ 健康检查          │
│  /api/status      ✅ 状态查询          │
│  /static/*        ✅ 静态资源          │
│                                         │
│  [新增 URL]  [删除选中]  [导入]         │
│                                         │
└─────────────────────────────────────────┘

新增方式:
  URL 模式: [/api/upload]
  说明: [文件上传接口]
  [添加]
```

#### 3. 批量导入

```
【CSV 导入格式】

IP 白名单:
  ip,description
  127.0.0.1,localhost
  192.168.1.0/24,internal_network

URL 白名单:
  url,description
  /api/health,health_check
  /admin/*,admin_interface

【导入步骤】
  1. 准备 CSV 文件
  2. 点击 [导入] 按钮
  3. 选择文件
  4. 确认导入
```

---

## 🚀 部署（Deploy）

**用途**: 最终部署配置，启动代理，切换运行模式

### 运行模式

```
┌──────────────────────────────────────────┐
│  运行模式选择                            │
├──────────────────────────────────────────┤
│                                          │
│  当前模式: 🛡️ 保护模式                  │
│                                          │
│  [ ] 🛡️ 保护模式 (Protection)          │
│      - 拦截恶意请求，返回 403          │
│      - 推荐用于生产环境                 │
│      - 需谨慎配置白名单避免误杀        │
│                                          │
│  [ ] 📊 检测模式 (Detection)            │
│      - 仅记录攻击，允许请求通过         │
│      - 推荐用于测试和学习               │
│      - 用于收集数据和微调规则           │
│                                          │
│  [应用设置]                              │
│                                          │
└──────────────────────────────────────────┘
```

### 代理管理

```
┌──────────────────────────────────────────┐
│  反向代理设置                            │
├──────────────────────────────────────────┤
│                                          │
│  代理状态: ❌ 未启动                    │
│                                          │
│  后端应用地址:                           │
│  [http://localhost:9090]                │
│                                          │
│  代理监听端口:                           │
│  [8080]                                  │
│                                          │
│  WAF UI 地址:                            │
│  [http://localhost:8082]                │
│                                          │
│  [ 启动代理 ]  [ 停止 ]                 │
│                                          │
│  启动后的访问流程:                       │
│  用户 → http://localhost:8080           │
│       ↓                                  │
│      WAF 检测                            │
│       ↓                                  │
│  后端应用 (http://localhost:9090)       │
│                                          │
└──────────────────────────────────────────┘
```

### 配置信息

```
┌──────────────────────────────────────────┐
│  当前配置                                │
├──────────────────────────────────────────┤
│                                          │
│  监听地址: 0.0.0.0                      │
│  UI 端口: 8082                          │
│  代理端口: 8080                         │
│  后端应用: 待配置                       │
│                                          │
│  规则文件目录: rules/                  │
│  配置文件: config/settings.yaml         │
│  白名单文件: config/whitelist.yaml      │
│                                          │
│  日志保存: 内存存储（最多 10000 条）    │
│  最大日志数: 10000                      │
│                                          │
│  [ 重新加载规则 ]  [ 重启服务 ]         │
│                                          │
└──────────────────────────────────────────┘
```

---

## 🔄 完整的部署流程

### 场景 1：本地演示（仅 WAF UI，无代理）

```
步骤 1: 打开浏览器
  http://localhost:8082

步骤 2: 在 Web UI 中：
  - 查看仪表板（14 条规则加载状态）
  - 运行 test_attack_payloads.py
  - 在日志标签中查看拦截的攻击
  - 在规则标签中管理规则

步骤 3: 完成
  WAF 已就绪，可进行攻击测试
```

### 场景 2：保护本地应用

```
前置条件: 本地有一个应用运行在 http://localhost:9090

步骤 1: 打开 Web UI
  http://localhost:8082

步骤 2: 配置反向代理
  - 进入 [部署] 标签
  - 输入后端地址: http://localhost:9090
  - 点击 [启动代理]

步骤 3: 验证保护
  - 现在访问 http://localhost:8080
  - 所有请求都会先经过 WAF 检测
  - 恶意请求被阻止，日志被记录

步骤 4: 完成
  应用已受 WAF 保护
```

### 场景 3：虚拟机完整部署

```
步骤 1: 转移安装包到虚拟机
  (详见: ../03_ONE_CLICK_DEPLOYMENT.md)

步骤 2: 虚拟机上启动
  bash start-waf.sh

步骤 3: 虚拟机上启动 DVWA（可选）
  docker run -p 8081:80 vulnerables/web-dvwa

步骤 4: 在 Web UI 中配置
  - 后端地址: http://localhost:8081
  - 启动代理: 8080 端口
  - 选择运行模式: 保护模式

步骤 5: 测试攻击
  - 访问 http://vm-ip:8080
  - 尝试 SQL 注入、XSS 等攻击
  - 观察被拦截的请求

步骤 6: 完成
  WAF + DVWA 集成测试完成
```

---

## 🎯 常见操作指南

### 如何添加一个 IP 到白名单？

```
1. 点击 [⚪ 白名单] 标签
2. 在 "IP 白名单" 部分
3. 输入 IP 地址 (如: 192.168.1.100)
4. 输入说明 (如: 办公网络)
5. 点击 [添加]
6. IP 立即生效
```

### 如何禁用某条规则？

```
1. 点击 [🔒 规则] 标签
2. 找到要禁用的规则
3. 点击 [禁用] 按钮
4. 规则立即停止工作
5. 如需启用，点击 [启用]
```

### 如何查看被拦截的请求？

```
1. 点击 [📋 日志] 标签
2. 所有被拦截的请求都会列出
3. 可以按时间、类型、IP 筛选
4. 点击具体请求可查看详情
5. 点击 [导出 CSV] 可下载
```

### 如何启动反向代理？

```
1. 点击 [🚀 部署] 标签
2. 在 "反向代理设置" 部分
3. 输入后端应用地址 (如: http://localhost:9090)
4. 点击 [启动代理]
5. 代理开始在 8080 端口运行
6. 现在访问 http://localhost:8080 会通过 WAF
```

### 如何切换运行模式？

```
1. 点击 [🚀 部署] 标签
2. 在 "运行模式选择" 部分
3. 选择模式：
   - 🛡️ 保护模式：拦截恶意请求
   - 📊 检测模式：仅记录，不拦截
4. 点击 [应用设置]
5. 模式立即生效
```

---

## ⚡ 快速参考

| 操作 | 位置 | 快捷键 |
|------|------|--------|
| 查看攻击统计 | 仪表板 | - |
| 查看拦截日志 | 日志标签 | Ctrl+L |
| 管理规则 | 规则标签 | Ctrl+R |
| 添加白名单 | 白名单标签 | Ctrl+W |
| 启动代理 | 部署标签 | Ctrl+D |
| 刷新数据 | 任何标签 | F5 |
| 全屏显示 | 任何标签 | F11 |

---

## 🆘 常见问题

### Q: Web UI 无法访问？

**A**: 
```bash
# 检查 WAF 是否运行
python main.py --port 8082

# 检查防火墙
# Windows: 允许 Python 通过防火墙
# Linux: sudo ufw allow 8082
```

### Q: 规则没有生效？

**A**: 
1. 检查规则是否启用（规则标签）
2. 检查运行模式是否为"保护模式"
3. 点击"重新加载规则"刷新
4. 检查规则 YAML 文件语法

### Q: 如何导出日志？

**A**: 
1. 点击日志标签
2. 点击 [导出 CSV] 按钮
3. 选择下载位置
4. 在 Excel 中打开分析

---

**相关文档**:
- [一键部署指南](03_ONE_CLICK_DEPLOYMENT.md)
- [一键部署指南](03_ONE_CLICK_DEPLOYMENT.md)

**版本**: 1.0.0 | **许可证**: MIT
