# 🚀 一键部署指南 - 从安装到 Web 管理

## 📌 概述

**完整部署流程只需 3 步**：
1. ⬇️ 下载安装包
2. 🔧 运行安装脚本
3. 🌐 打开 Web 管理界面

**总耗时**: 3-5 分钟

---

## 第 1 步：获取安装包

### 方式 A：使用现成的包（推荐）

包位置：`dist/waf-1.0-*.zip`

```bash
# 检查包是否存在
ls -la dist/waf-1.0-*.zip
```

### 方式 B：自己打包

```bash
python build_dist.py --output dist/waf-1.0.zip
# 输出: dist/waf-1.0.zip
```

---

## 第 2 步：一键安装

### Windows 用户

```cmd
# 1. 解压包
# 使用 Windows 资源管理器或：
powershell -Command "Expand-Archive -Path 'waf-1.0-*.zip' -DestinationPath '.'"

# 2. 进入目录
cd waf-1.0

# 3. 运行启动脚本
start-waf.bat

# 脚本会自动：
# ✅ 检查 Python 版本
# ✅ 创建虚拟环境 (venv/)
# ✅ 安装依赖 (requirements.txt)
# ✅ 启动部署向导
```

### Linux / macOS 用户

```bash
# 1. 解压包
unzip waf-1.0-*.zip
cd waf-1.0

# 2. 运行启动脚本
bash start-waf.sh

# 脚本会自动：
# ✅ 检查 Python3 版本
# ✅ 创建虚拟环境 (venv/)
# ✅ 安装依赖 (requirements.txt)
# ✅ 启动部署向导
```

### 安装脚本做了什么？

```
start-waf.bat / start-waf.sh
    ↓
1. 检查环境
   - Python 版本 >= 3.8
   - pip 可用
   ↓
2. 创建虚拟环境
   - venv/ 目录
   ↓
3. 安装依赖（仅 5 个包）
   - flask
   - flask-cors
   - jinja2
   - requests
   - pyyaml
   ↓
4. 启动部署向导
   - 交互式菜单
   - 配置保存
   - 脚本生成
```

---

## 第 3 步：打开 Web 管理界面

### 自动启动

脚本会自动弹出浏览器，访问：

```
http://localhost:8082
```

### 手动启动

如果浏览器没有自动打开，手动访问：

```
http://localhost:8082
```

### 界面布局

```
┌─────────────────────────────────────────────────────┐
│  🛡️ DL混合WAF 1.0                                  │
├─────────────────────────────────────────────────────┤
│ [📊 仪表板] [📋 日志] [🔒 规则] [⚪ 白名单] [🚀 部署] │
├─────────────────────────────────────────────────────┤
│                                                     │
│  📊 仪表板                                         │
│  ├─ 实时攻击统计 (24h/7d/30d)                     │
│  ├─ 攻击类型分布 (饼图)                            │
│  └─ 规则状态                                       │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 在 Web 界面中完成部署

### 📊 仪表板标签

**用途**: 查看实时数据

```
显示内容：
  ✅ 规则加载状态 (14 条规则)
  ✅ 过去 24 小时攻击数
  ✅ 过去 7 天攻击数
  ✅ 过去 30 天攻击数
  ✅ 攻击类型分布图表
```

### 📋 日志标签

**用途**: 查看被拦截的请求

```
功能：
  ✅ 完整日志列表
  ✅ 按类型筛选（SQL 注入、XSS 等）
  ✅ 按时间范围筛选
  ✅ 导出为 CSV
```

### 🔒 规则标签

**用途**: 管理规则

```
功能：
  ✅ 查看所有 14 条规则
  ✅ 启用/禁用规则
  ✅ 查看规则详情（匹配模式）
  ✅ 按严重程度筛选
```

### ⚪ 白名单标签

**用途**: 添加信任的 IP/URL

```
功能：
  ✅ 添加 IP 白名单
  ✅ 添加 URL 白名单
  ✅ 批量导入
  ✅ 删除条目
```

### 🚀 部署标签

**用途**: 最终的部署配置

```
功能：
  1️⃣ 选择运行模式
     [ ] 🛡️ 保护模式 (阻止攻击)
     [ ] 📊 检测模式 (仅记录)
     
  2️⃣ 启动反向代理 (可选)
     [启动代理] - 在 8080 端口
     
  3️⃣ 查看配置信息
     - 监听地址: 0.0.0.0
     - UI 端口: 8082
     - 代理端口: 8080
     - 规则目录: rules/
```

---

## 完整的一键部署流程图

```
┌──────────────────────────┐
│  用户行为                │
└──────────────────────────┘
          │
          ▼
┌──────────────────────────────────────────┐
│  第 1 步：下载安装包                      │
│  dist/waf-1.0-YYYYMMDD_HHMMSS.zip       │
│  大小: 61 KB                             │
│  验证: SHA256 校验 ✓                     │
└──────────────────────────────────────────┘
          │
          ▼
┌──────────────────────────────────────────┐
│  第 2 步：一键启动 (start-waf.bat/sh)   │
│  ├─ Python 版本检查 ✓                    │
│  ├─ 虚拟环境创建 ✓                      │
│  ├─ 依赖安装 (5 个包) ✓                  │
│  └─ 启动部署向导 ✓                      │
└──────────────────────────────────────────┘
          │
          ▼
┌──────────────────────────────────────────┐
│  第 3 步：打开 Web 管理界面              │
│  http://localhost:8082                   │
│  ├─ 仪表板: 查看状态                    │
│  ├─ 日志: 查看被拦截的请求             │
│  ├─ 规则: 管理规则                      │
│  ├─ 白名单: 添加信任的 IP/URL           │
│  └─ 部署: 配置运行模式和代理            │
└──────────────────────────────────────────┘
          │
          ▼
┌──────────────────────────────────────────┐
│  部署完成！ ✅                            │
│  WAF 已保护应用                          │
│  管理界面: http://localhost:8082         │
│  代理端口: 8080 (如启用)                 │
└──────────────────────────────────────────┘
```

---

## 快速测试

### 方式 1：本地测试（无需外部应用）

```bash
curl http://localhost:8082/api/health

# 预期输出：
# [1] 🚨 被拦截 | SQL注入 - 基础
# [2] 🚨 被拦截 | SQL注入 - UNION
# [3] 🚨 被拦截 | XSS - 脚本标签
# [4] 🚨 被拦截 | XSS - 事件处理
# [5] 🚨 被拦截 | 目录遍历
# [6] 🚨 被拦截 | 文件包含
# [7] ✅ 通过 | 正常请求
```

### 方式 2：通过 Web UI 查看

1. 打开 http://localhost:8082
2. 运行测试脚本
3. 在"日志"标签中查看拦截的请求
4. 在"仪表板"中查看统计信息

---

## 三个部署方案

### 方案 A：本地测试（最简单）

```
用户电脑
    ↓
WAF UI (8082)
    ↓
测试脚本 / curl 命令
```

**优点**: 无需其他应用，快速验证  
**适用**: 学习、测试、演示

### 方案 B：保护本地应用

```
用户电脑
    ↓
WAF 代理 (8080)
    ↓
本地应用 (8081)
    ↓
WAF UI (8082) - 管理和监控
```

**优点**: 完整保护体验  
**适用**: 本地开发、演示

### 方案 C：虚拟机部署

```
虚拟机
    ├─ WAF UI (8082)
    ├─ WAF 代理 (8080)
    ├─ 目标应用 (8081)
    └─ DVWA (可选)
```

**优点**: 隔离环境，完整测试  
**适用**: 虚拟机测试、生产部署

---

## 常见部署问题

### Q1: 安装后无法访问 Web 界面

**症状**: 访问 http://localhost:8082 显示无法连接

**解决**:
```bash
# 1. 检查 Python 是否运行
# Windows: tasklist | findstr python
# Linux: ps aux | grep python

# 2. 手动启动 WAF
python main.py --port 8082

# 3. 检查防火墙
# Windows: 允许 Python 通过防火墙
# Linux: sudo ufw allow 8082
```

### Q2: 依赖安装失败

**症状**: `pip install` 出错

**解决**:
```bash
# 升级 pip
pip install --upgrade pip

# 重新安装
pip install -r requirements.txt --no-cache-dir
```

### Q3: 虚拟环境创建失败

**症状**: `venv/` 目录没有创建

**解决**:
```bash
# 手动创建
python -m venv venv

# 激活 (Windows)
venv\Scripts\activate.bat

# 激活 (Linux/macOS)
source venv/bin/activate
```

---

## 下一步

1. ✅ 安装完成
2. ⏭️ 在 Web UI 中配置规则和白名单
3. ⏭️ 启用反向代理保护应用
4. ⏭️ 定期查看日志和统计

---

**相关文档**:
- [Web 管理指南](02_WEB_MANAGEMENT.md)
- [一键部署指南](03_ONE_CLICK_DEPLOYMENT.md)
- [虚拟机部署](../06_documentation/VM_DEPLOYMENT.md)

**版本**: 1.0.0 | **许可证**: MIT
